import{j as e,c as N,r as x,u as w,d as y,b as D}from"./index-d01e31b1.js";import{B as S,G,S as J}from"./utils-d76b11d7.js";import{M as P,a as B}from"./Modal-9faaa2ba.js";import{J as C}from"./JournalSelect-589c8687.js";import{u as $,M as I}from"./MessageBlock-47298185.js";import{P as L}from"./Paginator-bea37458.js";import{M as E}from"./utils-978ca1b9.js";import"./bootstrap.bundle.min-a81abbd8.js";function A({lessons:d}){return e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:2}),e.jsx("th",{colSpan:d.length,className:"text-center",children:"Даты"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Фамилия, имя"}),d.map(n=>e.jsx("th",{children:e.jsx("div",{className:"m-auto text-center",children:`${new Date(n.date_val).getDate()<10?"0":""}${new Date(n.date_val).getDate()}`})},n.id))]})]})}function H({grade:d,lessons:n,onMarkChange:h}){function u(o,c){const l=o.marks.find(m=>m.student_id===c.id);return l?l.mark_value:""}return e.jsx("tbody",{children:d.map((o,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:c+1}),e.jsxs("td",{style:{width:"15%"},children:[o.surname," ",o.name[0],"."]}),n.map(l=>e.jsx("td",{className:"m-0 p-0",children:e.jsx(S,{additionalClasses:"text-center invisible-input border-0",onInput:m=>{h(o.id,l.id,m.currentTarget.value)},value:u(l,o)})},l.id))]},o.id))})}function Q(){const d=N(),[n,h]=x.useState([]),[u,o]=x.useState(0),[c,l]=x.useState([]),m=$(),v=w();x.useEffect(()=>{G({id:Number(d.journal_id)}).then(t=>{h(t.lessons),l(t.grade.sort((a,r)=>a.surname.localeCompare(r.surname)))})},[d.journal_id]);function b(t,a,r){const s=n,i=s.findIndex(_=>_.id===a),p=s[i].marks.findIndex(_=>_.student_id===t);let f;p===-1?(s[i].marks.push({student_id:t,mark_value:r,lesson_id:a}),f=s[i].marks[s[i].marks.length-1]):(s[i].marks[p].mark_value=r,f=s[i].marks[p]),J({mark:f}).then(()=>{}),h(s)}function M(t){t.length==0?m(D({type:"danger",text:"Нет журнала для этого класса и предмета"})):v(`/journal/${t[0].id}`)}function j(){const t=[];for(let a=0;a<n.length;a++){const r=new Date(n[a].date_val);t.push(r.getMonth())}return Array.from(new Set(t))}function g(){let t=j()[u];return n.filter(a=>new Date(a.date_val).getMonth()===t)}function k(t){const a=new Date(t),r=a.getMonth(),s=a.getDate();return`${s>9?s:"0"+s}.${r>9?r:"0"+r}`}return e.jsxs("div",{className:"full-height",children:[e.jsx(I,{}),e.jsx(P,{connected_with:"select_journal_modal",title:"Выбор журнала",children:e.jsx(C,{GetJournal:M})}),e.jsx(B,{connected_with:"select_journal_modal",additionalClasses:"m-3",button_text:"Выбор журнала"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-10 col-12",children:n.length>0?e.jsxs("div",{children:[e.jsx(L,{max_page:j().length-1,current_page:u,onPageChange:t=>{o(t)},custom_page_names:j().map(t=>E(t))}),e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx(A,{lessons:g()}),e.jsx(H,{grade:c,lessons:g(),onMarkChange:b})]})]}):e.jsx(y,{})}),e.jsx("div",{className:"col-2 overflow-auto d-none d-lg-block",style:{maxHeight:"80vh"},children:e.jsx("table",{className:"table table-bordered table-striped",children:e.jsx("tbody",{children:g().map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{style:{verticalAlign:"middle"},children:k(t.date_val)}),e.jsx("td",{children:t.theme.name})]},a))})})})]})]})}export{Q as default};
