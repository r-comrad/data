import{j as e,c as P,r as u,u as N,d as G,b as J}from"./index-50c8aee8.js";import{B as y,G as B,M as j,S as C}from"./utils-bafe39db.js";import{M as w,a as E}from"./Modal-3506476a.js";import{J as I}from"./JournalSelect-e6da1e59.js";import{u as L,M as A}from"./MessageBlock-96fe4be3.js";import{P as D}from"./Paginator-1f3b96ab.js";import"./utils-346fb4c0.js";function F({lessons:o}){return e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:2}),e.jsx("th",{colSpan:o.length,className:"text-center",children:"Даты"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Фамилия, имя"}),o.map(t=>e.jsx("th",{children:e.jsx("div",{className:"m-auto",style:{"writing-mode":"vertical-rl","text-orientation":"mixed"},children:t.date_val})},t.id))]})]})}function H({grade:o,lessons:t,onMarkChange:m}){function l(s,d){const n=s.marks.find(c=>c.student_id===d.id);return n?n.mark_value:""}return e.jsx("tbody",{children:o.map((s,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:d+1}),e.jsxs("td",{style:{width:"15%"},children:[s.surname," ",s.name[0],"."]}),t.map(n=>e.jsx("td",{className:"m-0 p-0",children:e.jsx(y,{additionalClasses:"text-center invisible-input border-0",onInput:c=>{m(s.id,n.id,c.currentTarget.value)},value:l(n,s)})},n.id))]},s.id))})}function z(){const o=P(),[t,m]=u.useState([]),[l,s]=u.useState(0),[d,n]=u.useState(-1),[c,k]=u.useState([]),M=L(),b=N();u.useEffect(()=>{B({id:Number(o.journal_id)}).then(a=>{m(a.lessons),k(a.grade.sort((x,h)=>x.surname.localeCompare(h.surname))),n(a.lessons.length/j)})},[o.journal_id]);function S(a,x,h){const r=t,i=r.findIndex(f=>f.id===x),p=r[i].marks.findIndex(f=>f.student_id===a);let g;p===-1?(r[i].marks.push({student_id:a,mark_value:h,lesson_id:x}),g=r[i].marks[r[i].marks.length-1]):(r[i].marks[p].mark_value=h,g=r[i].marks[p]),C({mark:g}).then(()=>{}),m(r)}function v(a){a.length==0?M(J({type:"danger",text:"Нет журнала для этого класса и предмета"})):b(`/journal/${a[0].id}`)}function _(){return t.slice(l*j,l*j+j)}return e.jsxs("div",{className:"full-height",children:[e.jsx(A,{}),e.jsx(w,{connected_with:"select_journal_modal",title:"Выбор журнала",children:e.jsx(I,{GetJournal:v})}),e.jsx(E,{connected_with:"select_journal_modal",additionalClasses:"m-3",button_text:"Выбор журнала"}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx(F,{lessons:_()}),e.jsx(H,{grade:c,lessons:_(),onMarkChange:S})]}),e.jsx(D,{max_page:d,current_page:l,onPageChange:a=>{s(a)}})]}):e.jsx(G,{})]})}export{z as default};
