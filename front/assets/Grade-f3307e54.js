import{r as l,j as r}from"./index-cfa7943e.js";import{h as f,b as S,i as O,j}from"./utils-3ad0bc39.js";import{T as $}from"./Table-214de0f1.js";import{M as w,a as F}from"./Modal-49a1a758.js";import{F as M,E as c}from"./Form-df0725bd.js";import{b as T}from"./bootstrap.bundle.min-21484380.js";import"./axios-4a70c6fc.js";import"./config-67b08cc3.js";import"./utils-978ca1b9.js";import"./Grow-65f5fe91.js";function R(){const[u,a]=l.useState([]),[o,h]=l.useState([]),[m,p]=l.useState({});l.useEffect(()=>{f().then(t=>{a(t)}),S().then(t=>{h(t)})},[]);function b(){return o.filter(e=>!e.role.includes("student")).map(e=>({id:e.id,label:`${e.surname} ${e.name[0]}.`}))}function g(){return o.filter(e=>e.role.includes("student")).map(e=>({value:e.id,text:`${e.surname} ${e.name[0]}.`}))}function G(t){m.id&&(t.id=m.id),O(t).then(()=>{f().then(e=>{console.log(e),a(e)})})}function x(t){a(u.filter(e=>!t.includes(e.id))),j(t)}function E(t){p(t),new T.Modal(document.getElementById("grade_modal"),{}).show()}function i(t,e){var s;switch(e){case"head_id":let n=o.find(d=>d.id===t.head_id);return`${n==null?void 0:n.surname} ${n==null?void 0:n.name[0]}.`;case"student":return(s=t.student)==null?void 0:s.length;default:return t[e]}}function _(t,e){const s=u.sort((n,d)=>i(n,t)>i(d,t)?e?1:-1:i(n,t)<i(d,t)?e?-1:1:0);a([...s])}return r.jsxs(r.Fragment,{children:[r.jsx(w,{title:"Класс",connected_with:"grade_modal",children:r.jsx(M,{elements:[{name:"name",label:"Имя",type:c.INPUT,settings:{}},{name:"head_id",label:"Руководитель",type:c.COMBOBOX,settings:{options:b()}},{name:"student",label:"Ученики",type:c.SMART_SELECT,settings:{options:g(),multiple:!0,size:10}}],instance:m,onSubmit:G})}),r.jsx(F,{connected_with:"grade_modal",button_text:"Создание класса",additionalClasses:"m-3",preOpen:()=>{p({})}}),r.jsx($,{elements:u,table_fields:[{label:"Имя",name:"name"},{label:"Руководитель",name:"head_id",valueProcessing:t=>{let e=o.find(s=>s.id===t);if(e)return`${e.surname} ${e.name[0]}.`}},{label:"Количество учащихся",name:"student",valueProcessing:t=>t.length}],NeedDelete:!0,NeedEdit:!0,Sort:_,onDelete:x,onEdit:E})]})}export{R as default};
