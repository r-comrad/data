import{r as a,j as i}from"./index-2931db17.js";import{l as f,i as M,b as C,g as J,f as P,F as L,E as o,m as $,n as w}from"./utils-26674dc9.js";import{T as D}from"./Table-b6de09e7.js";import{M as F,a as R,b as U}from"./Modal-be4b3969.js";import{G as B}from"./utils-346fb4c0.js";function q(){const[h,l]=a.useState([]),[u,x]=a.useState([]),[r,j]=a.useState([]),[c,A]=a.useState([]),[_,G]=a.useState([]),[p,b]=a.useState({});a.useEffect(()=>{f().then(e=>{l(e)}),M().then(e=>{x(e)}),C().then(e=>{j(e)}),J().then(e=>{A(e)}),P().then(e=>{G(e)})},[]);function T(){return r.filter(t=>!t.role.includes("student")).map(t=>({value:t.id,text:`${t.surname} ${t.name[0]}.`}))}function v(e){var t;p.id&&(e.id=p.id),e.grade_id&&(e.head_id=(t=u.find(n=>n.id===Number(e.grade_id)))==null?void 0:t.head_id),e.methodist_id=B().id,w(e).then(()=>{f().then(n=>{l(n)})})}function m(e,t){var n,d,S,g,E;switch(e){case"grade_id":return(n=u.find(s=>s.id===t.grade_id))==null?void 0:n.name;case"subject_id":return(d=c.find(s=>s.id===t.subject_id))==null?void 0:d.name;case"plan_id":return(S=_.find(s=>s.id===t.plan_id))==null?void 0:S.name;case"teacher_id":return(g=r.find(s=>s.id===t.teacher_id))==null?void 0:g.name;case"methodist_id":return(E=r.find(s=>s.id===t.methodist_id))==null?void 0:E.name;default:return t[e]}}function y(e,t){l([...h.sort((n,d)=>t?m(e,n)>m(e,d)?1:-1:m(e,n)<m(e,d)?1:-1)])}return i.jsxs(i.Fragment,{children:[i.jsx(F,{title:"Журнал",connected_with:"journal_modal",children:i.jsx(L,{elements:[{label:"Класс",name:"grade_id",type:o.SMART_SELECT,settings:{options:u.map(e=>({value:e.id,text:e.name}))}},{label:"Предмет",name:"subject_id",type:o.SMART_SELECT,settings:{options:c.map(e=>({value:e.id,text:e.name}))}},{label:"План",name:"plan_id",type:o.SMART_SELECT,settings:{options:_.map(e=>({value:e.id,text:e.name}))}},{label:"Учитель",name:"teacher_id",type:o.SMART_SELECT,settings:{options:T()}},{label:"Рассписание",name:"schedule",type:o.SCHEDULE,settings:{}}],instance:p,onSubmit:v})}),i.jsx(R,{connected_with:"journal_modal",button_text:"Создать журнал",additionalClasses:"m-3",preOpen:()=>{b({})}}),i.jsx(D,{elements:h,table_fields:[{label:"Класс",name:"grade_id",valueProcessing:e=>{var t;return(t=u.find(n=>n.id===e))==null?void 0:t.name}},{label:"Предмет",name:"subject_id",valueProcessing:e=>{var t;return(t=c.find(n=>n.id===e))==null?void 0:t.name}},{label:"План",name:"plan_id",valueProcessing:e=>{var t;return(t=_.find(n=>n.id===e))==null?void 0:t.name}},{label:"Учитель",name:"teacher_id",valueProcessing:e=>{let t=r.find(n=>n.id===e);if(t)return`${t.surname} ${t.name[0]}.`}},{label:"Методист",name:"methodist_id",valueProcessing:e=>{let t=r.find(n=>n.id===e);if(t)return`${t.surname} ${t.name[0]}.`}}],NeedEdit:!0,NeedDelete:!0,Sort:y,onDelete:e=>{$(e).then(()=>{f().then(t=>{l(t)})})},onEdit:e=>{b(e),new U.Modal(document.getElementById("journal_modal"),{}).show()}})]})}export{q as default};
