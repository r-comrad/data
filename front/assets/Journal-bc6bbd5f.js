import{r as s,j as i}from"./index-ac9c09ba.js";import{k as f,h as P,b as y,f as C,e as M,F as w,E as o,P as L,l as $,m as D}from"./utils-a5a48fe5.js";import{T as F}from"./Table-5d1b32c1.js";import{M as R,a as U}from"./Modal-122696de.js";import{b as B}from"./bootstrap.bundle.min-a4fb55f5.js";import{G as k}from"./utils-978ca1b9.js";function K(){const[h,l]=s.useState([]),[u,x]=s.useState([]),[r,j]=s.useState([]),[c,A]=s.useState([]),[_,G]=s.useState([]),[p,b]=s.useState({});s.useEffect(()=>{f().then(e=>{l(e)}),P().then(e=>{x(e)}),y().then(e=>{j(e)}),C().then(e=>{A(e)}),M().then(e=>{G(e)})},[]);function T(){return r.filter(t=>!t.role.includes("student")).map(t=>({value:t.id,text:`${t.surname} ${t.name[0]}.`}))}function v(e){var t;p.id&&(e.id=p.id),e.grade_id&&(e.head_id=(t=u.find(n=>n.id===Number(e.grade_id)))==null?void 0:t.head_id),e.methodist_id=k().id,D(e).then(()=>{f().then(n=>{l(n)})})}function m(e,t){var n,d,S,g,E;switch(e){case"grade_id":return(n=u.find(a=>a.id===t.grade_id))==null?void 0:n.name;case"subject_id":return(d=c.find(a=>a.id===t.subject_id))==null?void 0:d.name;case"plan_id":return(S=_.find(a=>a.id===t.plan_id))==null?void 0:S.name;case"teacher_id":return(g=r.find(a=>a.id===t.teacher_id))==null?void 0:g.name;case"methodist_id":return(E=r.find(a=>a.id===t.methodist_id))==null?void 0:E.name;default:return t[e]}}function J(e,t){l([...h.sort((n,d)=>t?m(e,n)>m(e,d)?1:-1:m(e,n)<m(e,d)?1:-1)])}return i.jsxs(i.Fragment,{children:[i.jsx(R,{title:"Журнал",connected_with:"journal_modal",children:i.jsx(w,{elements:[{label:"Класс",name:"grade_id",type:o.SMART_SELECT,settings:{options:u.map(e=>({value:e.id,text:e.name}))}},{label:"Предмет",name:"subject_id",type:o.SMART_SELECT,settings:{options:c.map(e=>({value:e.id,text:e.name}))}},{label:"План",name:"plan_id",type:o.SMART_SELECT,settings:{options:_.map(e=>({value:e.id,text:e.name}))}},{label:"Учитель",name:"teacher_id",type:o.SMART_SELECT,settings:{options:T()}},{label:"Рассписание",name:"schedule",type:o.SCHEDULE,settings:{}}],instance:p,onSubmit:v})}),i.jsx(U,{connected_with:"journal_modal",button_text:"Создать журнал",additionalClasses:"m-3",preOpen:()=>{b({})}}),i.jsx(F,{elements:h,table_fields:[{label:"Класс",name:"grade_id",valueProcessing:e=>{var t;return(t=u.find(n=>n.id===e))==null?void 0:t.name}},{label:"Предмет",name:"subject_id",valueProcessing:e=>{var t;return(t=c.find(n=>n.id===e))==null?void 0:t.name}},{label:"План",name:"plan_id",valueProcessing:e=>{var t;return(t=_.find(n=>n.id===e))==null?void 0:t.name}},{label:"Учитель",name:"teacher_id",valueProcessing:e=>{let t=r.find(n=>n.id===e);if(t)return`${t.surname} ${t.name[0]}.`}},{label:"Методист",name:"methodist_id",valueProcessing:e=>{let t=r.find(n=>n.id===e);if(t)return`${t.surname} ${t.name[0]}.`}},{label:"Распечатать журналы",name:"id",checkbox:{onButtonClick:e=>{L(e).then(t=>{window.open(t)})}}}],NeedEdit:!0,NeedDelete:!0,Sort:J,onDelete:e=>{$(e).then(()=>{f().then(t=>{l(t)})})},onEdit:e=>{b(e),new B.Modal(document.getElementById("journal_modal"),{}).show()}})]})}export{K as default};
