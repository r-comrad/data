import{j as e,c as v,r as u,u as G,d as J,b as N}from"./index-2931db17.js";import{B,G as C,M as h,S as y}from"./utils-26674dc9.js";import{M as E,a as I}from"./Modal-be4b3969.js";import{J as w}from"./JournalSelect-7b479ce1.js";import{u as L,M as A}from"./MessageBlock-72cf53d8.js";import{P as D}from"./Paginator-19791848.js";import"./utils-346fb4c0.js";function F({lessons:o}){return e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"}}),o.map(t=>e.jsx("th",{className:"text-center",children:t.date_val},t.id))]})})}function H({grade:o,lessons:t,onMarkChange:c}){function d(s,r){const i=s.marks.find(g=>g.student_id===r.id);return i?i.mark_value:""}return e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[s.surname," ",s.name[0],"."]}),t.map(r=>e.jsx("td",{children:e.jsx(B,{additionalClasses:"text-center invisible-input border-0",onInput:i=>{c(s.id,r.id,i.currentTarget.value)},value:d(r,s)})},r.id))]},s.id))})}function z(){const o=v(),[t,c]=u.useState([]),[d,s]=u.useState(0),[r,i]=u.useState(-1),[g,k]=u.useState([]),M=L(),b=G();u.useEffect(()=>{C({id:Number(o.journal_id)}).then(a=>{c(a.lessons),k(a.grade.sort((m,x)=>m.surname.localeCompare(x.surname))),i(a.lessons.length/h)})},[o.journal_id]);function P(a,m,x){const n=t,l=n.findIndex(f=>f.id===m),j=n[l].marks.findIndex(f=>f.student_id===a);let p;j===-1?(n[l].marks.push({student_id:a,mark_value:x,lesson_id:m}),p=n[l].marks[n[l].marks.length-1]):(n[l].marks[j].mark_value=x,p=n[l].marks[j]),y({mark:p}).then(()=>{}),c(n)}function S(a){a.length==0?M(N({type:"danger",text:"Нет журнала для этого класса и предмета"})):b(`/journal/${a[0].id}`)}function _(){return t.slice(d*h,d*h+h)}return e.jsxs("div",{className:"full-height",children:[e.jsx(A,{}),e.jsx(E,{connected_with:"select_journal_modal",title:"Выбор журнала",children:e.jsx(w,{GetJournal:S})}),e.jsx(I,{connected_with:"select_journal_modal",additionalClasses:"m-3",button_text:"Выбор журнала"}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx(F,{lessons:_()}),e.jsx(H,{grade:g,lessons:_(),onMarkChange:P})]}),e.jsx(D,{max_page:r,current_page:d,onPageChange:a=>{s(a)}})]}):e.jsx(J,{})]})}export{z as default};
