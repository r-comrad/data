import{r as u,j as r}from"./index-d01e31b1.js";import{h as p,b as _,F as j,E as c,i as T,j as $}from"./utils-d76b11d7.js";import{T as w}from"./Table-935d271d.js";import{M as F,a as M}from"./Modal-9faaa2ba.js";import{b as O}from"./bootstrap.bundle.min-a81abbd8.js";function U(){const[l,a]=u.useState([]),[o,h]=u.useState([]),[m,f]=u.useState({});u.useEffect(()=>{p().then(t=>{a(t)}),_().then(t=>{h(t)})},[]);function b(){return o.filter(e=>!e.role.includes("student")).map(e=>({value:e.id,text:`${e.surname} ${e.name[0]}.`}))}function E(){return o.filter(e=>e.role.includes("student")).map(e=>({value:e.id,text:`${e.surname} ${e.name[0]}.`}))}function g(t){m.id&&(t.id=m.id),T(t).then(()=>{p().then(e=>{console.log(e),a(e)})})}function x(t){a(l.filter(e=>!t.includes(e.id))),$(t)}function G(t){f(t),new O.Modal(document.getElementById("grade_modal"),{}).show()}function d(t,e){var s;switch(e){case"head_id":let n=o.find(i=>i.id===t.head_id);return`${n==null?void 0:n.surname} ${n==null?void 0:n.name[0]}.`;case"student":return(s=t.student)==null?void 0:s.length;default:return t[e]}}function S(t,e){const s=l.sort((n,i)=>d(n,t)>d(i,t)?e?1:-1:d(n,t)<d(i,t)?e?-1:1:0);a([...s])}return r.jsxs(r.Fragment,{children:[r.jsx(F,{title:"Класс",connected_with:"grade_modal",children:r.jsx(j,{elements:[{name:"name",label:"Имя",type:c.INPUT,settings:{}},{name:"head_id",label:"Руководитель",type:c.SMART_SELECT,settings:{options:b()}},{name:"student",label:"Ученики",type:c.SMART_SELECT,settings:{options:E(),multiple:!0,size:10}}],instance:m,onSubmit:g})}),r.jsx(M,{connected_with:"grade_modal",button_text:"Создание класса",additionalClasses:"m-3",preOpen:()=>{f({})}}),r.jsx(w,{elements:l,table_fields:[{label:"Имя",name:"name"},{label:"Руководитель",name:"head_id",valueProcessing:t=>{let e=o.find(s=>s.id===t);if(e)return`${e.surname} ${e.name[0]}.`}},{label:"Количество учащихся",name:"student",valueProcessing:t=>t.length}],NeedDelete:!0,NeedEdit:!0,Sort:S,onDelete:x,onEdit:G})]})}export{U as default};
